---
title: "Data Prep"
author: "Vajinder"
date: "2024-11-11"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Different stocks under different industries

1. Automobile

Tata Motors (TATAMOTORS)
Mahindra & Mahindra (M&M)
Maruti Suzuki (MARUTI)
Bajaj Auto (BAJAJ-AUTO)
Hero MotoCorp (HEROMOTOCO)

```{r, warning=FALSE}
library(lubridate)
library(dplyr)
setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis/Automobile")
BajajAuto <- read.csv("BAJA.csv")
BajajAuto$Stock <- "Bajaj Auto"

HeroMoto <- read.csv("HROM.csv")
HeroMoto$Stock <- "Hero MotoCorp"

Mahindra <- read.csv("MAHM.csv")
Mahindra$Stock <- "Mahindra & Mahindra"

MarutiSuzuki <- read.csv("MRTI.csv")
MarutiSuzuki$Stock <- "Maruti Suzuki"

TataMotors <- read.csv("TAMO.csv")
TataMotors$Stock <- "Tata Motors"


Automobile <- rbind(BajajAuto, HeroMoto, Mahindra, MarutiSuzuki, TataMotors)
Automobile$Category <- "Automobile"
Automobile <- Automobile %>%
  select(1, Category, everything())
Automobile <- Automobile %>%
  select(2, Stock, everything())


write.csv(Automobile, "Automobile.csv", row.names = FALSE)
```
2. Consumer Goods
Hindustan Unilever (HINDUNILVR)
ITC Limited (ITC)
Nestle India (NESTLEIND)
Dabur India (DABUR)
Britannia Industries (BRITANNIA)

```{r, warning=FALSE}
setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis/Consumer Goods")
Britannia <- read.csv("BRIT.csv")
Britannia$Stock <- "Britannia Industries"

Nestle <- read.csv("NEST.csv")
Nestle$Stock <- "Nestle India"

ITC <- read.csv("ITC.csv")
ITC$Stock <- "ITC Limited"

Dabur <- read.csv("DABU.csv")
Dabur$Stock <- "Dabur India"

HindustanUnilever <- read.csv("HLL.csv")
HindustanUnilever$Stock <- "Hindustan Unilever"


ConsumerGoods <- rbind(HindustanUnilever, Dabur, ITC, Nestle, Britannia)
ConsumerGoods$Category <- "Consumer Goods"
ConsumerGoods <- ConsumerGoods %>%
  select(1, Category, everything())
ConsumerGoods <- ConsumerGoods %>%
  select(2, Stock, everything())

write.csv(ConsumerGoods, "ConsumerGoods.csv", row.names = FALSE)
```

3. Energy
Reliance Industries (RELIANCE)
Oil and Natural Gas Corporation (ONGC)
Indian Oil Corporation (IOC)
NTPC Limited (NTPC)
Power Grid Corporation (POWERGRID)

```{r, warning=FALSE}
setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis/Energy")

Reliance <- read.csv("RELI.csv")
Reliance$Stock <- "Reliance Industries s"

ONGC <- read.csv("ONGC.csv")
ONGC$Stock <- "Oil and Natural Gas Corporation"

IOC <- read.csv("IOC.csv")
IOC$Stock <- "Indian Oil Corporation"

NTPC <- read.csv("NTPC.csv")
NTPC$Stock <- "NTPC Limited"

PGRD <- read.csv("PGRD.csv")
PGRD$Stock <- "Power Grid Corporation"


Energy <- rbind(Reliance, ONGC, IOC, NTPC, PGRD)
Energy$Category <- "Energy"
Energy <- Energy %>%
  select(1, Category, everything())
Energy <- Energy %>%
  select(2, Stock, everything())

write.csv(Energy, "Energy.csv", row.names = FALSE)
```

4. Finance
HDFC Bank (HDFCBANK)
ICICI Bank (ICICIBANK)
State Bank of India (SBIN)
Bajaj Finance (BAJFINANCE)
Axis Bank (AXISBANK)

```{r, warning=FALSE}
setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis/Finance")

HDFC <- read.csv("HDBK.csv")
HDFC$Stock <- "HDFC Bank"

ICICI <- read.csv("ICBK.csv")
ICICI$Stock <- "ICICI Bank"

SBI <- read.csv("SBI.csv")
SBI$Stock <- "State Bank of India"

Axis <- read.csv("AXBK.csv")
Axis$Stock <- "Axis Bank"

Bajaj <- read.csv("BJFN.csv")
Bajaj$Stock <- "Bajaj Finance"


Finance <- rbind(HDFC, ICICI, SBI, Axis, Bajaj)
Finance$Category <- "Finance"
Finance <- Finance %>%
  select(1, Category, everything())
Finance <- Finance %>%
  select(2, Stock, everything())

write.csv(Finance, "Finance.csv", row.names = FALSE)
```

5. Healthcare
Sun Pharmaceutical (SUNPHARMA)
Dr. Reddy's Laboratories (DRREDDY)
Cipla (CIPLA)
Apollo Hospitals (APOLLOHOSP)
Biocon (BIOCON)

```{r, warning=FALSE}
setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis/HealthCare")

SUN <- read.csv("SUN.csv")
SUN$Stock <- "Sun Pharmaceutical"

REDY <- read.csv("REDY.csv")
REDY$Stock <- "Dr. Reddy's Laboratories"

CIPLA <- read.csv("CIPL.csv")
CIPLA$Stock <- "Cipla"

APLH <- read.csv("APLH.csv")
APLH$Stock <- "Apollo Hospitals"

BION <- read.csv("BION.csv")
BION$Stock <- "Biocon"


HealthCare <- rbind(BION, APLH, CIPLA, REDY, SUN)
HealthCare$Category <- "HealthCare"
HealthCare <- HealthCare %>%
  select(1, Category, everything())
HealthCare <- HealthCare %>%
  select(2, Stock, everything())

write.csv(HealthCare, "HealthCare.csv", row.names = FALSE)
```

6. Technology
Tata Consultancy Services (TCS)
Infosys (INFY)
Wipro (WIPRO)
HCL Technologies (HCLTECH)
Tech Mahindra (TEML)

```{r, warning=FALSE}

setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis/Tech")

HCLT <- read.csv("HCLT.csv")
HCLT$Stock <- "HCL Technologies"

TCS <- read.csv("TCS.csv")
TCS$Stock <- "Tata Consultancy Services"

TEML <- read.csv("TEML.csv")
TEML$Stock <- "Tech Mahindra "

WIPR <- read.csv("WIPR.csv")
WIPR$Stock <- "Wipro"

INFY <- read.csv("INFY.csv")
INFY$Stock <- "Infosys"


Tech <- rbind(TEML, WIPR, TCS, INFY, HCLT)
Tech$Category <- "Tech"
Tech <- Tech %>%
  select(1, Category, everything())
Tech <- Tech %>%
  select(2, Stock, everything())

write.csv(Tech, "Tech.csv", row.names = FALSE)

```

7. Infrastructure
Larsen & Toubro (LT)
DLF Limited (DLF)
Adani Ports & SEZ (ADANIPORTS)
Ultratech Cement (ULTRACEMCO)
Ambuja Cements (ABUJ)

```{r, warning=FALSE}
setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis/Infrastructure")

APSE <- read.csv("APSE.csv")
APSE$Stock <- "Adani Ports & SEZ"

DLF <- read.csv("DLF.csv")
DLF$Stock <- "DLF Limited "

ULTC <- read.csv("ULTC.csv")
ULTC$Stock <- "Ultratech Cement"

LART <- read.csv("LART.csv")
LART$Stock <- "Larsen & Toubro"

ABUJ <- read.csv("ABUJ.csv")
ABUJ$Stock <- "Ambuja Cements"


InfraStructure <- rbind(ABUJ, LART, ULTC, DLF, APSE)
InfraStructure$Category <- "Infrastructure"

InfraStructure <- InfraStructure %>%
  select(1, Category, everything())
InfraStructure <- InfraStructure %>%
  select(2, Stock, everything())

write.csv(InfraStructure, "Infrastructure.csv", row.names = FALSE)
```
Combining the datasets

```{r}
# Set working directory
setwd("C:/Users/Lenovo/Project/Applied Statistical Modelling/Japanese Candlestick Pattern Analysis")

file_paths <- c("InfraStructure/InfraStructure.csv", 
                "HealthCare/HealthCare.csv", 
                "Tech/Tech.csv", 
                "Finance/Finance.csv", 
                "Energy/Energy.csv", 
                "Automobile/Automobile.csv", 
                "Consumer Goods/ConsumerGoods.csv")

Stocks <- do.call(rbind, lapply(file_paths, read.csv))
write.csv(Stocks, "Stocks.csv", row.names = FALSE)
```

## Lower Shadow, Upper Shadow, Body, Whole Candle


```{r, warning=FALSE}
Stocks <- Stocks |> mutate(
    Open = as.numeric(Open),
    Price = as.numeric(Price),
    Low = as.numeric(Low),
    High = as.numeric(High)
  ) |>
  mutate(
    `Lower Shadow` = pmin(Open, Price) - Low,  
    `Upper Shadow` = High - pmax(Open, Price),  
     Body = abs(Open - Price),            
    `Whole Candle` = High - Low         
  )
```
## Getting the patterns : Shooting Star, Hammer

```{r}
Stocks <- Stocks |>
  mutate(
    Pattern = case_when(
      Body /`Whole Candle` <= 0.25 & `Upper Shadow`/`Whole Candle` <= 0.05 ~ "Shooting Star",  
      Body /`Whole Candle` <= 0.25 & `Lower Shadow`/`Whole Candle` <= 0.05 ~ "Hammer",         
      TRUE ~ "Other"
    )
  )
```

## Moving Averages


```{r}
library(zoo)

Stocks <- Stocks %>%
  mutate(
    MA_5 = rollapply(Price, 5, mean, fill = NA, align = "right"),  # 5-day MA
    MA_7 = rollapply(Price, 7, mean, fill = NA, align = "right"),  # 7-day MA
    MA_10 = rollapply(Price, 10, mean, fill = NA, align = "right") )  # 9-day MA

```
## Setting up the threshold for trends

```{r}
# Function to calculate the trend based on MA values
calculate_trend <- function(ma_values, threshold = 0.7) {
  # Calculate the difference between consecutive moving averages
  diff_values <- diff(ma_values, lag = 1)
  # Count the number of increases and decreases
  num_increases <- sum(diff_values > 0, na.rm = TRUE)
  num_decreases <- sum(diff_values < 0, na.rm = TRUE)
  # Calculate the percentage of increases and decreases
  pct_increase <- num_increases / length(ma_values)
  
  pct_decrease <- num_decreases / length(ma_values)
  
  # Determine the trend
  if (pct_increase >= threshold) {
    return("Uptrend")
  } else if (pct_decrease >= threshold) {
    return("Downtrend")
  } else {
    return("No Trend")
  }
}

# Apply the trend calculation directly to the moving averages columns (MA3, MA5, MA7, MA9)
Stocks <- Stocks |>
  mutate(
    Trend_D5 = mapply(calculate_trend, list(MA_5), MoreArgs = list(threshold = 0.7)),
    Trend_D7 = mapply(calculate_trend, list(MA_7), MoreArgs = list(threshold = 0.7)),
    Trend_D10 = mapply(calculate_trend, list(MA_10), MoreArgs = list(threshold = 0.7))
  )


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
